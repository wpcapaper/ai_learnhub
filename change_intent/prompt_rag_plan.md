# RAG æ¨¡å—å®ç°æ–¹æ¡ˆ

## ä¸€ã€éœ€æ±‚è¯„ä¼°

### 1.1 åŸå§‹éœ€æ±‚æ‘˜è¦

| éœ€æ±‚é¡¹ | æè¿° |
|--------|------|
| æ ¸å¿ƒç›®æ ‡ | åŸºäº markdown æ•™ç¨‹çš„ RAG æ¨¡å— |
| åŒç”¨æˆ·æ”¯æŒ | ç”¨æˆ·ï¼ˆCç«¯æŸ¥è¯¢ï¼‰+ Agentï¼ˆé…ç½®è¯„ä¼°ï¼‰ |
| æ²™ç®±éš”ç¦» | Agent å·¥å…·åœ¨éš”ç¦» sandbox ç¯å¢ƒè¿è¡Œ |
| é…ç½®è¯„ä¼° | Agent è¯„ä¼°æ–‡æ¡£åˆ‡åˆ†æ–¹æ¡ˆï¼Œè¾“å‡ºæ­£å¼ç¯å¢ƒé…ç½® |
| **æ•™ç¨‹è´¨é‡è¯„ä¼°** | **åˆ‡åˆ†å‰å…ˆè¯„ä¼°æ•´ä¸ªè¯¾ç¨‹ç›®å½•ï¼Œç”Ÿæˆè´¨é‡æŠ¥å‘Šï¼ŒæŒ‡å‡ºäº‰è®®å’Œè°¬è¯¯** |
| **æ³¨é‡Šå±•ç¤º** | **è´¨é‡æŠ¥å‘Šä½œä¸º metadataï¼Œä»¥æ³¨é‡Šå½¢å¼å±•ç¤ºï¼Œä¸å½±å“åŸæ–‡** |
| æ¨¡å—è§£è€¦ | æ²™ç®± Agent Tool ç‹¬ç«‹æ¨¡å—ï¼Œå¯ä¿å¯† |
| GraphRAG | é¢„ç•™çŸ¥è¯†å›¾è°± + å‘é‡ç›¸ä¼¼åº¦è¿‡æ»¤èƒ½åŠ› |
| æµ‹è¯•é¡µé¢ | **ç‹¬ç«‹å‰ç«¯é¡¹ç›®**éƒ¨ç½²ï¼ŒæŒ‰éœ€ä¸Šçº¿ï¼ŒIP ç™½åå•è®¿é—®æ§åˆ¶ |
| å¯é…ç½® | embedding/rerank æ¨¡å‹é…ç½®åŒ– |
| æŒä¹…åŒ– | ChromaDBï¼Œæ•°æ®åº“æ–‡ä»¶ gitignore |
| ç®¡ç†ç«¯æ¼”è¿› | æœªæ¥å°†ç°æœ‰è„šæœ¬åŠŸèƒ½ UI åŒ–ï¼Œæ„å»ºå®Œæ•´ç®¡ç†ç«¯ |

### 1.2 åˆç†æ€§è¯„ä¼°

#### âœ… åˆç†ä¸”å¿…è¦çš„éƒ¨åˆ†

| éœ€æ±‚ | è¯„ä¼° |
|------|------|
| **RAG æ•™ç¨‹åŠŸèƒ½** | å­¦ä¹ å¹³å°æ‰©å±•æ•™ç¨‹çŸ¥è¯†åº“æ˜¯è‡ªç„¶çš„æ¼”è¿›æ–¹å‘ |
| **åŒç”¨æˆ·æ¶æ„** | C ç«¯ç”¨æˆ·æŸ¥è¯¢ + ç®¡ç†ç«¯é…ç½®è¯„ä¼°ï¼ŒèŒè´£æ¸…æ™° |
| **Sandbox éš”ç¦»** | Agent æ“ä½œä¸ç›´æ¥æ±¡æŸ“ç”Ÿäº§æ•°æ®ï¼Œå®‰å…¨å®è·µ |
| **é…ç½®åŒ–æ¨¡å‹** | embedding/rerank å¯åˆ‡æ¢ï¼Œçµæ´»æ€§å¼º |
| **ChromaDB é€‰å‹** | è½»é‡çº§å‘é‡æ•°æ®åº“ï¼Œé€‚åˆä¸­å°è§„æ¨¡åœºæ™¯ |

#### âš ï¸ éœ€è¦æ¾„æ¸…/ä¼˜åŒ–çš„éƒ¨åˆ†

| é—®é¢˜ç‚¹ | å»ºè®® |
|--------|------|
| **GraphRAG æ—¶æœº** | ç¬¬ä¸€æœŸå…ˆå®ç°åŸºç¡€ RAGï¼ŒGraphRAG ä½œä¸º v2 æ‰©å±•ï¼Œé¿å…è¿‡åº¦è®¾è®¡ |
| **ChromaDB å­˜æ”¾ä½ç½®** | éœ€åŒºåˆ†å¼€å‘/ç”Ÿäº§/å®¹å™¨åŒ–åœºæ™¯ï¼Œå»ºè®®ç‹¬ç«‹é…ç½® |
| **Agent Tool è¾¹ç•Œ** | "å¯ä¿å¯†çš„æ²™ç®±æ¨¡å—"è¾¹ç•Œéœ€æ˜ç¡®ï¼Œå»ºè®®æŠ½è±¡ä¸º Plugin æ¥å£ |

#### âœ… å·²ç¡®è®¤çš„è®¾è®¡å†³ç­–

| å†³ç­–ç‚¹ | ç»“è®º |
|--------|------|
| **æµ‹è¯•é¡µé¢éƒ¨ç½²** | ç‹¬ç«‹å‰ç«¯é¡¹ç›®ï¼ˆéå¤ç”¨ç°æœ‰ Next.jsï¼‰ï¼ŒæŒ‰éœ€éƒ¨ç½² |
| **è®¿é—®æ§åˆ¶** | æ­£å¼ç¯å¢ƒé€šè¿‡ IP ç™½åå•æ§åˆ¶è®¿é—® |
| **ç®¡ç†ç«¯è§„åˆ’** | åˆ†é˜¶æ®µæ¼”è¿›ï¼Œå…ˆå®ç° RAG æµ‹è¯•ï¼Œåç»­å°†è„šæœ¬åŠŸèƒ½ UI åŒ– |

#### âŒ æ½œåœ¨é£é™©

| é£é™© | ç¼“è§£æªæ–½ |
|------|----------|
| embedding æ¨¡å‹èµ„æºæ¶ˆè€— | æ”¯æŒè¿œç¨‹ APIï¼ˆOpenAI/æœ¬åœ°æœåŠ¡ï¼‰ï¼Œé¿å…å®¹å™¨å†…åŠ è½½å¤§æ¨¡å‹ |
| æ–‡æ¡£åˆ‡åˆ†ç­–ç•¥å¤æ‚åº¦ | æä¾›å¤šç§é¢„è®¾ç­–ç•¥ï¼ˆæŒ‰æ®µè½/æŒ‰æ ‡é¢˜/æŒ‰ tokenï¼‰ï¼Œé™ä½é…ç½®é—¨æ§› |
| å‘é‡åº“æ•°æ®è¿ç§» | è®¾è®¡ schema ç‰ˆæœ¬æœºåˆ¶ï¼Œæ”¯æŒå¢é‡æ›´æ–° |

---

## äºŒã€æ¶æ„è®¾è®¡

### 2.1 ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              AILearn Hub ç”Ÿæ€ç³»ç»Ÿ                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                           C ç«¯ç”¨æˆ·è®¿é—®å±‚                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚   â”‚
â”‚  â”‚  â”‚   Frontend (Next.js)    â”‚   â† å…¬ç½‘å¼€æ”¾                                â”‚   â”‚
â”‚  â”‚  â”‚   - åˆ·é¢˜/è€ƒè¯•/å¤ä¹       â”‚                                             â”‚   â”‚
â”‚  â”‚  â”‚   - RAG æ•™ç¨‹æŸ¥è¯¢        â”‚                                             â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                  â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚               â”‚              ç®¡ç†ç«¯è®¿é—®å±‚                                â”‚   â”‚
â”‚  â”‚               â–¼                                                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚              Admin Frontend (ç‹¬ç«‹é¡¹ç›®)                          â”‚     â”‚   â”‚
â”‚  â”‚  â”‚              â† IP ç™½åå•è®¿é—®æ§åˆ¶                                â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   RAG Test UI    â”‚  â”‚  Future Admin    â”‚                    â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   - å¬å›æµ‹è¯•     â”‚  â”‚  - è„šæœ¬åŠŸèƒ½ UI   â”‚                    â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   - å‚æ•°è°ƒä¼˜     â”‚  â”‚  - æ•°æ®ç®¡ç†      â”‚                    â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   - è¯„ä¼°æŠ¥å‘Š     â”‚  â”‚  - ç³»ç»Ÿé…ç½®      â”‚                    â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚                                          â”‚
â”‚                                      â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                          FastAPI Backend                                   â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ /api/    â”‚ â”‚ /api/    â”‚ â”‚ /api/    â”‚ â”‚ /api/rag/*  â”‚ â”‚ /api/admin/* â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ quiz     â”‚ â”‚ exam     â”‚ â”‚ learning â”‚ â”‚ (RAG æŸ¥è¯¢)  â”‚ â”‚ (ç®¡ç†æ¥å£)   â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                      â”‚                                          â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚           â–¼                          â–¼                          â–¼              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  SQLite/PG     â”‚        â”‚  ChromaDB      â”‚        â”‚  Sandbox Agent       â”‚ â”‚
â”‚  â”‚  (ä¸šåŠ¡æ•°æ®)    â”‚        â”‚  (å‘é‡å­˜å‚¨)    â”‚        â”‚  (å¯ç‹¬ç«‹éƒ¨ç½²)        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                      â”‚                                          â”‚
â”‚                                      â–¼                                          â”‚
â”‚                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚                           â”‚  Embedding/Rerank  â”‚                               â”‚
â”‚                           â”‚  (æœ¬åœ°/API)        â”‚                               â”‚
â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 é¡¹ç›®ç»“æ„è§„åˆ’

```
aie55_llm5_learnhub/
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ backend/                    # ç°æœ‰åç«¯
â”‚   â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”‚   â”œâ”€â”€ rag/               # RAG æ ¸å¿ƒæ¨¡å— (æ–°å¢)
â”‚   â”‚   â”‚   â”œâ”€â”€ rag_sandbox/       # æ²™ç®± Agent æ¨¡å— (æ–°å¢)
â”‚   â”‚   â”‚   â””â”€â”€ admin/             # ç®¡ç†ç«¯ API (æ–°å¢)
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ frontend/                   # ç°æœ‰ C ç«¯å‰ç«¯ (Next.js)
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â””â”€â”€ admin-frontend/             # ã€æ–°å¢ã€‘ç®¡ç†ç«¯å‰ç«¯ (ç‹¬ç«‹é¡¹ç›®)
â”‚       â”œâ”€â”€ package.json
â”‚       â”œâ”€â”€ app/
â”‚       â”‚   â”œâ”€â”€ rag-test/          # RAG æµ‹è¯•é¡µé¢
â”‚       â”‚   â”‚   â”œâ”€â”€ page.tsx       # å¬å›æµ‹è¯•
â”‚       â”‚   â”‚   â”œâ”€â”€ evaluation/    # è¯„ä¼°æŠ¥å‘Š
â”‚       â”‚   â”‚   â””â”€â”€ config/        # å‚æ•°è°ƒä¼˜
â”‚       â”‚   â”‚
â”‚       â”‚   â””â”€â”€ (future)/          # æœªæ¥æ‰©å±•
â”‚       â”‚       â”œâ”€â”€ data-import/   # æ•°æ®å¯¼å…¥ (æ›¿ä»£è„šæœ¬)
â”‚       â”‚       â”œâ”€â”€ course-mgmt/   # è¯¾ç¨‹ç®¡ç†
â”‚       â”‚       â””â”€â”€ system/        # ç³»ç»Ÿé…ç½®
â”‚       â”‚
â”‚       â”œâ”€â”€ components/
â”‚       â”œâ”€â”€ lib/
â”‚       â””â”€â”€ Dockerfile
â”‚
â”œâ”€â”€ scripts/                        # ç°æœ‰è„šæœ¬ (æœªæ¥é€æ­¥ UI åŒ–)
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ config/
â”‚   â””â”€â”€ rag_config.yaml            # RAG é…ç½®
â”‚
â””â”€â”€ docker-compose.yml             # æ›´æ–°ï¼Œæ·»åŠ  admin-frontend æœåŠ¡
```

### 2.3 ç®¡ç†ç«¯é¡¹ç›®æŠ€æœ¯é€‰å‹

| å±‚é¢ | æŠ€æœ¯é€‰å‹ | ç†ç”± |
|------|----------|------|
| æ¡†æ¶ | Next.js 16 | ä¸ C ç«¯ä¿æŒä¸€è‡´ï¼Œé™ä½å­¦ä¹ æˆæœ¬ |
| UI åº“ | shadcn/ui + Tailwind | å¿«é€Ÿæ„å»ºç®¡ç†ç•Œé¢ |
| å›¾è¡¨ | Recharts / Chart.js | è¯„ä¼°æŠ¥å‘Šå¯è§†åŒ– |
| çŠ¶æ€ | Zustand / React Query | è½»é‡çº§çŠ¶æ€ç®¡ç† |
| è®¤è¯ | IP ç™½åå• + å¯é€‰ Basic Auth | ç®€å•å¯é  |

### 2.4 åç«¯æ¨¡å—è®¾è®¡

```
src/backend/app/
â”œâ”€â”€ rag/                          # RAG æ ¸å¿ƒæ¨¡å— (æ–°å¢)
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ core/                     # æ ¸å¿ƒç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ embedder.py           # Embedding æŠ½è±¡å±‚
â”‚   â”‚   â”œâ”€â”€ reranker.py           # Rerank æŠ½è±¡å±‚
â”‚   â”‚   â”œâ”€â”€ splitter.py           # æ–‡æ¡£åˆ‡åˆ†ç­–ç•¥
â”‚   â”‚   â””â”€â”€ retriever.py          # æ£€ç´¢å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ stores/                   # å‘é‡å­˜å‚¨
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ chroma_store.py       # ChromaDB å®ç°
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                 # ä¸šåŠ¡æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ document_service.py   # æ–‡æ¡£ç®¡ç†
â”‚   â”‚   â””â”€â”€ query_service.py      # æŸ¥è¯¢æœåŠ¡
â”‚   â”‚
â”‚   â”œâ”€â”€ models/                   # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ document.py           # æ–‡æ¡£/åˆ‡ç‰‡æ¨¡å‹
â”‚   â”‚   â””â”€â”€ config.py             # RAG é…ç½®æ¨¡å‹
â”‚   â”‚
â”‚   â””â”€â”€ api/                      # API è·¯ç”±
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ documents.py          # æ–‡æ¡£ç®¡ç† API
â”‚       â””â”€â”€ query.py              # æŸ¥è¯¢ API
â”‚
â”œâ”€â”€ rag_sandbox/                  # æ²™ç®± Agent æ¨¡å— (ç‹¬ç«‹ï¼Œå¯ä¿å¯†)
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ tools/                    # Agent å·¥å…·
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ chunk_evaluator.py    # åˆ‡åˆ†è¯„ä¼°å·¥å…·
â”‚   â”‚   â”œâ”€â”€ retrieval_tester.py   # å¬å›æµ‹è¯•å·¥å…·
â”‚   â”‚   â””â”€â”€ config_generator.py   # é…ç½®ç”Ÿæˆå·¥å…·
â”‚   â”‚
â”‚   â””â”€â”€ sandbox_executor.py       # æ²™ç®±æ‰§è¡Œå™¨
â”‚
â””â”€â”€ admin/                        # ç®¡ç†ç«¯ API (æ–°å¢)
    â”œâ”€â”€ __init__.py
    â””â”€â”€ rag_admin.py              # RAG ç®¡ç†æ¥å£
```

### 2.5 æ•°æ®æµè®¾è®¡

#### C ç«¯ç”¨æˆ·æŸ¥è¯¢æµç¨‹

```
ç”¨æˆ· Query
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯è¾“å…¥   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  POST /api/rag/query                â”‚
â”‚  { "query": "ä»€ä¹ˆæ˜¯ Seq2Seq?",      â”‚
â”‚    "course_id": "llm_basic" }       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  QueryService.query()               â”‚
â”‚  1. Embedding(query)                â”‚
â”‚  2. ChromaDB.similarity_search()    â”‚
â”‚  3. [Optional] Rerank()             â”‚
â”‚  4. æ ¼å¼åŒ–è¿”å›                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Response                           â”‚
â”‚  { "results": [                     â”‚
â”‚      { "content": "...",            â”‚
â”‚        "source": "tutorial.md",     â”‚
â”‚        "score": 0.92 },             â”‚
â”‚      ...                            â”‚
â”‚    ]                                â”‚
â”‚  }                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Agent é…ç½®è¯„ä¼°æµç¨‹

```
ç®¡ç†å‘˜ + æ•™ç¨‹æ–‡æ¡£
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  POST /api/admin/rag/evaluate       â”‚
â”‚  { "documents": [...],              â”‚
â”‚    "split_strategies": [...],       â”‚
â”‚    "embedding_model": "text-emb" }  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Sandbox Executor                   â”‚
â”‚  (éš”ç¦»ç¯å¢ƒï¼Œä¸è®¿é—®ç”Ÿäº§ ChromaDB)     â”‚
â”‚  1. æ‰§è¡Œåˆ‡åˆ†ç­–ç•¥                     â”‚
â”‚  2. ç”Ÿæˆä¸´æ—¶å‘é‡åº“                   â”‚
â”‚  3. è¿è¡Œå¬å›æµ‹è¯•                     â”‚
â”‚  4. è¯„ä¼°æŒ‡æ ‡è®¡ç®—                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Evaluation Report                  â”‚
â”‚  { "strategy_scores": {             â”‚
â”‚      "by_paragraph": 0.85,          â”‚
â”‚      "by_heading": 0.78             â”‚
â”‚    },                               â”‚
â”‚    "recommended": "by_paragraph",   â”‚
â”‚    "config_export": {...}           â”‚
â”‚  }                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ•™ç¨‹è´¨é‡è¯„ä¼°æµç¨‹ï¼ˆå‰ç½®æµç¨‹ï¼‰

```
è¯¾ç¨‹ç›®å½• (Markdown æ–‡ä»¶)
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  POST /api/admin/rag/quality-check  â”‚
â”‚  { "course_id": "llm_basic",        â”‚
â”‚    "document_paths": [...] }        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Quality Assessment Agent           â”‚
â”‚  (Sandbox ç¯å¢ƒæ‰§è¡Œ)                  â”‚
â”‚  1. éå†æ‰€æœ‰æ–‡æ¡£                     â”‚
â”‚  2. å†…å®¹å®Œæ•´æ€§æ£€æŸ¥                   â”‚
â”‚  3. é€»è¾‘ä¸€è‡´æ€§æ£€æŸ¥                   â”‚
â”‚  4. äº‰è®®/è°¬è¯¯è¯†åˆ«                    â”‚
â”‚  5. ç”Ÿæˆè´¨é‡æŠ¥å‘Š                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Quality Report                     â”‚
â”‚  {                                  â”‚
â”‚    "overall_score": 85,             â”‚
â”‚    "issues": [                      â”‚
â”‚      {                              â”‚
â”‚        "file": "seq2seq.md",        â”‚
â”‚        "line": 45,                  â”‚
â”‚        "type": "controversial",     â”‚
â”‚        "severity": "medium",        â”‚
â”‚        "description": "è¯¥æè¿°ä¸...",â”‚
â”‚        "suggestion": "å»ºè®®æ”¹ä¸º..."  â”‚
â”‚      }                              â”‚
â”‚    ],                               â”‚
â”‚    "metadata": {...}                â”‚
â”‚  }                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Metadata å­˜å‚¨ (ä¸å½±å“åŸæ–‡)          â”‚
â”‚  - å­˜å…¥æ•°æ®åº“ (document_annotations)â”‚
â”‚  - å‰ç«¯æ¸²æŸ“æ—¶å åŠ å±•ç¤º                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æµç¨‹è¯´æ˜ï¼š**
1. è´¨é‡è¯„ä¼°åœ¨åˆ‡åˆ†è¯„ä¼°ä¹‹å‰æ‰§è¡Œ
2. è¯„ä¼°ç»“æœå­˜å‚¨ä¸ºç‹¬ç«‹ metadataï¼Œä¸ä¿®æ”¹åŸå§‹æ–‡ä»¶
3. è´¨é‡æŠ¥å‘Šéœ€äººå·¥å®¡æ ¸åæ‰èƒ½å¯¹ C ç«¯ç”¨æˆ·å¯è§
4. æ”¯æŒç®¡ç†å‘˜æ ‡è®°"å·²ç¡®è®¤/å·²ä¿®å¤/å¿½ç•¥"

---

## ä¸‰ã€è¯¦ç»†è®¾è®¡

### 3.1 Embedding éƒ¨ç½²ç­–ç•¥

#### åœºæ™¯åŒºåˆ†

| åœºæ™¯ | æ¨èæ–¹æ¡ˆ | ç†ç”± |
|------|----------|------|
| **C ç«¯ç”Ÿäº§æŸ¥è¯¢** | è¿œç¨‹ API (OpenAI/å…¶ä»–) | ç¨³å®šã€æ— éœ€æœ¬åœ°èµ„æºã€å“åº”å¿« |
| **C ç«¯ç”Ÿäº§æŸ¥è¯¢** | æœ¬åœ°æ¨¡å‹ (å¯é€‰) | æˆæœ¬å¯æ§ã€æ•°æ®ä¸ç¦»å¢ƒã€é€‚åˆé«˜é¢‘è°ƒç”¨ |
| **Agent è¯„ä¼°è°ƒè¯•** | æœ¬åœ°æ¨¡å‹ (ä¼˜å…ˆ) | å¤§é‡è°ƒè¯•è¿­ä»£ã€æ—  API è´¹ç”¨ã€å¿«é€Ÿåé¦ˆ |

#### é…ç½®è®¾è®¡

```yaml
# config/rag_config.yaml

# ç”Ÿäº§ç¯å¢ƒ Embedding é…ç½®
embedding:
  # æ”¯æŒä¸‰ç§ provider
  provider: "openai"  # local | openai | custom
  
  # === OpenAI é…ç½® ===
  openai:
    model: "text-embedding-3-small"
    api_key: "${OPENAI_API_KEY}"
    # å¯é€‰ï¼šæŒ‡å®š base_urlï¼ˆç”¨äºä»£ç†æˆ–å…¼å®¹æœåŠ¡ï¼‰
    # base_url: "https://api.openai.com/v1"
  
  # === æœ¬åœ°æ¨¡å‹é…ç½® ===
  local:
    model: "sentence-transformers/all-MiniLM-L6-v2"
    # ä¸­æ–‡åœºæ™¯æ¨è: "shibing624/text2vec-base-chinese"
    device: "cpu"  # cpu | cuda | mps
    cache_dir: "./models/embedding"
  
  # === è‡ªå®šä¹‰æœåŠ¡é…ç½® ===
  custom:
    endpoint: "http://embedding-service:8001/embed"
    api_key: "${CUSTOM_EMBED_KEY}"  # å¯é€‰
    timeout: 30

# Agent è¯„ä¼°ç¯å¢ƒé…ç½®ï¼ˆå¯è¦†ç›–ç”Ÿäº§é…ç½®ï¼‰
sandbox:
  embedding:
    # è¯„ä¼°ä¼˜å…ˆä½¿ç”¨æœ¬åœ°æ¨¡å‹ï¼Œé¿å…å¤§é‡ API è°ƒç”¨è´¹ç”¨
    provider: "local"
    model: "sentence-transformers/all-MiniLM-L6-v2"
    device: "cpu"
  
  # è¯„ä¼°ä¸“ç”¨ä¸´æ—¶ç›®å½•
  temp_dir: "/tmp/rag_sandbox"
  
  # èµ„æºé™åˆ¶
  limits:
    max_memory_mb: 2048
    timeout_seconds: 300

# Rerank é…ç½®
rerank:
  enabled: true
  provider: "local"
  model: "cross-encoder/ms-marco-MiniLM-L-6-v2"
  top_k: 5

# å‘é‡å­˜å‚¨é…ç½®
vector_store:
  type: "chroma"
  persist_directory: "./data/chroma"
  collection_name: "tutorial_chunks"

# æ–‡æ¡£åˆ‡åˆ†é…ç½®
chunking:
  default_strategy: "by_heading"
  strategies:
    by_paragraph:
      max_tokens: 512
      overlap: 50
    by_heading:
      respect_structure: true
      max_tokens: 1024
      overlap: 100

# GraphRAG é…ç½® (v2 åŠŸèƒ½)
graph_rag:
  enabled: false
  knowledge_graph:
    extraction_model: null
    similarity_threshold: 0.7
```

#### Embedder æŠ½è±¡å±‚è®¾è®¡

```python
# app/rag/core/embedder.py

from abc import ABC, abstractmethod
from typing import List
import numpy as np

class BaseEmbedder(ABC):
    """Embedding æŠ½è±¡åŸºç±»"""
    
    @abstractmethod
    def embed(self, texts: List[str]) -> np.ndarray:
        """å°†æ–‡æœ¬åˆ—è¡¨è½¬æ¢ä¸ºå‘é‡"""
        pass
    
    @abstractmethod
    def embed_query(self, query: str) -> np.ndarray:
        """å°†å•ä¸ªæŸ¥è¯¢è½¬æ¢ä¸ºå‘é‡"""
        pass


class LocalEmbedder(BaseEmbedder):
    """æœ¬åœ°æ¨¡å‹å®ç° (sentence-transformers)"""
    
    def __init__(self, model_name: str, device: str = "cpu"):
        from sentence_transformers import SentenceTransformer
        self.model = SentenceTransformer(model_name, device=device)
    
    def embed(self, texts: List[str]) -> np.ndarray:
        return self.model.encode(texts, normalize_embeddings=True)
    
    def embed_query(self, query: str) -> np.ndarray:
        return self.model.encode([query], normalize_embeddings=True)[0]


class OpenAIEmbedder(BaseEmbedder):
    """OpenAI API å®ç°"""
    
    def __init__(self, model: str, api_key: str, base_url: str = None):
        from openai import OpenAI
        self.client = OpenAI(api_key=api_key, base_url=base_url)
        self.model = model
    
    def embed(self, texts: List[str]) -> np.ndarray:
        response = self.client.embeddings.create(
            input=texts, model=self.model
        )
        return np.array([d.embedding for d in response.data])
    
    def embed_query(self, query: str) -> np.ndarray:
        return self.embed([query])[0]


class CustomEmbedder(BaseEmbedder):
    """è‡ªå®šä¹‰ HTTP æœåŠ¡å®ç°"""
    
    def __init__(self, endpoint: str, api_key: str = None, timeout: int = 30):
        self.endpoint = endpoint
        self.headers = {"Authorization": f"Bearer {api_key}"} if api_key else {}
        self.timeout = timeout
    
    def embed(self, texts: List[str]) -> np.ndarray:
        import httpx
        response = httpx.post(
            self.endpoint,
            json={"texts": texts},
            headers=self.headers,
            timeout=self.timeout
        )
        return np.array(response.json()["embeddings"])
    
    def embed_query(self, query: str) -> np.ndarray:
        return self.embed([query])[0]


def create_embedder(config: dict) -> BaseEmbedder:
    """å·¥å‚å‡½æ•°ï¼šæ ¹æ®é…ç½®åˆ›å»º Embedder"""
    provider = config.get("provider", "local")
    
    if provider == "local":
        return LocalEmbedder(
            model_name=config["local"]["model"],
            device=config["local"].get("device", "cpu")
        )
    elif provider == "openai":
        return OpenAIEmbedder(
            model=config["openai"]["model"],
            api_key=config["openai"]["api_key"],
            base_url=config["openai"].get("base_url")
        )
    elif provider == "custom":
        return CustomEmbedder(
            endpoint=config["custom"]["endpoint"],
            api_key=config["custom"].get("api_key"),
            timeout=config["custom"].get("timeout", 30)
        )
    else:
        raise ValueError(f"Unknown embedding provider: {provider}")
```

### 3.2 API æ¥å£è®¾è®¡

#### C ç«¯æŸ¥è¯¢ API

```yaml
# POST /api/rag/query
Request:
  query: string           # ç”¨æˆ·æŸ¥è¯¢
  course_id?: string      # è¯¾ç¨‹è¿‡æ»¤
  top_k?: number          # è¿”å›æ•°é‡ï¼Œé»˜è®¤ 5
  include_metadata?: bool # æ˜¯å¦åŒ…å«å…ƒæ•°æ®

Response:
  results:
    - content: string     # æ–‡æœ¬å†…å®¹
      source: string      # æ¥æºæ–‡ä»¶
      score: number       # ç›¸ä¼¼åº¦
      metadata?: object   # é¢å¤–å…ƒæ•°æ®

# GET /api/rag/courses/{course_id}/documents
Response:
  documents:
    - id: string
      filename: string
      chunk_count: number
      indexed_at: string
```

#### ç®¡ç†ç«¯ API

```yaml
# POST /api/admin/rag/documents
Request:
  course_id: string
  files: File[]          # Markdown æ–‡ä»¶

Response:
  uploaded: number
  processed: number
  document_ids: string[]

# POST /api/admin/rag/evaluate
Request:
  course_id: string
  test_queries:
    - query: string
      expected_sources: string[]
  split_strategies: string[]

Response:
  evaluation_id: string
  status: "pending" | "completed" | "failed"
  report_url: string     # å®Œæˆåè·å–æŠ¥å‘Š

# GET /api/admin/rag/evaluate/{evaluation_id}
Response:
  status: string
  report:
    strategy_scores: object
    recommended: string
    config_export: object

# DELETE /api/admin/rag/documents/{document_id}
Response:
  deleted: boolean
```

### 3.3 æ•™ç¨‹è´¨é‡è¯„ä¼°è®¾è®¡

#### æ³¨é‡Šå®ç°æ–¹æ¡ˆè¯„ä¼°

| æ–¹æ¡ˆ | æè¿° | ä¼˜ç‚¹ | ç¼ºç‚¹ | æ¨èåº¦ |
|------|------|------|------|--------|
| **A. æ•°æ®åº“å­˜å‚¨** | metadata å­˜å…¥ç‹¬ç«‹è¡¨ï¼Œä¸æ–‡æ¡£è·¯å¾„å…³è” | ä¸ä¿®æ”¹åŸæ–‡ã€çµæ´»æŸ¥è¯¢ã€æ”¯æŒç‰ˆæœ¬ | éœ€è¦é¢å¤–æ•°æ®åº“è®¾è®¡ | â­â­â­â­â­ |
| B. ç‹¬ç«‹ JSON æ–‡ä»¶ | æ¯ä¸ª md æ–‡ä»¶å¯¹åº” .annotations.json | å¯ç‰ˆæœ¬æ§åˆ¶ã€ç‹¬ç«‹ç®¡ç† | æ–‡ä»¶æ•°é‡ç¿»å€ã€åŒæ­¥å›°éš¾ | â­â­â­ |
| C. YAML Front Matter | åœ¨ md å¤´éƒ¨æ·»åŠ å…ƒæ•°æ®å— | å•æ–‡ä»¶ç®¡ç† | ä¿®æ”¹åŸæ–‡ã€ä¸é€‚åˆè¡Œçº§æ³¨é‡Š | â­â­ |
| D. HTML æ³¨é‡Šå†…åµŒ | `<!-- @annotation: ... -->` | æºç å¯è§ | ä¿®æ”¹åŸæ–‡ã€å½±å“å¯è¯»æ€§ | â­ |

**æ¨èæ–¹æ¡ˆ Aï¼šæ•°æ®åº“å­˜å‚¨**

#### æ•°æ®æ¨¡å‹è®¾è®¡

```sql
-- æ•™ç¨‹æ–‡æ¡£è¡¨
CREATE TABLE tutorial_documents (
    id VARCHAR(36) PRIMARY KEY,
    course_id VARCHAR(36) NOT NULL,
    file_path VARCHAR(500) NOT NULL,
    file_hash VARCHAR(64),           -- ç”¨äºæ£€æµ‹æ–‡ä»¶å˜æ›´
    content_hash VARCHAR(64),        -- å†…å®¹hashï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦éœ€è¦é‡æ–°è¯„ä¼°
    indexed_at TIMESTAMP,
    quality_checked_at TIMESTAMP,
    quality_score INTEGER,           -- 0-100
    FOREIGN KEY (course_id) REFERENCES courses(id),
    UNIQUE(course_id, file_path)
);

-- æ–‡æ¡£æ³¨é‡Šè¡¨ (ä¸ä¿®æ”¹åŸæ–‡)
CREATE TABLE document_annotations (
    id VARCHAR(36) PRIMARY KEY,
    document_id VARCHAR(36) NOT NULL,
    
    -- ä½ç½®ä¿¡æ¯
    line_start INTEGER,              -- èµ·å§‹è¡Œå·
    line_end INTEGER,                -- ç»“æŸè¡Œå·
    text_snippet VARCHAR(200),       -- ç›¸å…³æ–‡æœ¬ç‰‡æ®µï¼ˆç”¨äºå®šä½ï¼‰
    
    -- æ³¨é‡Šå†…å®¹
    annotation_type ENUM(
        'controversial',             -- äº‰è®®æ€§å†…å®¹
        'error',                     -- æ˜æ˜¾é”™è¯¯
        'outdated',                  -- è¿‡æ—¶ä¿¡æ¯
        'incomplete',                -- å†…å®¹ä¸å®Œæ•´
        'suggestion',                -- æ”¹è¿›å»ºè®®
        'question'                   -- å­˜ç–‘å¾…ç¡®è®¤
    ),
    severity ENUM('low', 'medium', 'high', 'critical'),
    
    -- è¯¦ç»†æè¿°
    title VARCHAR(200),              -- æ³¨é‡Šæ ‡é¢˜
    description TEXT,                -- è¯¦ç»†æè¿°ï¼ˆæ”¯æŒ Markdownï¼‰
    suggestion TEXT,                 -- ä¿®æ”¹å»ºè®®ï¼ˆæ”¯æŒ Markdownï¼‰
    references TEXT,                 -- å‚è€ƒèµ„æ–™é“¾æ¥ï¼ˆJSON æ•°ç»„ï¼‰
    
    -- çŠ¶æ€ç®¡ç†
    status ENUM('pending', 'confirmed', 'fixed', 'ignored', 'false_positive'),
    reviewed_by VARCHAR(36),         -- å®¡æ ¸äºº
    reviewed_at TIMESTAMP,
    
    -- å¯è§æ€§
    visibility ENUM('admin_only', 'reviewer', 'public') DEFAULT 'admin_only',
    
    -- å…ƒæ•°æ®
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP,
    
    FOREIGN KEY (document_id) REFERENCES tutorial_documents(id),
    FOREIGN KEY (reviewed_by) REFERENCES users(id)
);

-- è´¨é‡è¯„ä¼°æŠ¥å‘Šè¡¨
CREATE TABLE quality_reports (
    id VARCHAR(36) PRIMARY KEY,
    course_id VARCHAR(36) NOT NULL,
    
    -- æ€»ä½“è¯„åˆ†
    overall_score INTEGER,           -- 0-100
    completeness_score INTEGER,      -- å®Œæ•´æ€§è¯„åˆ†
    consistency_score INTEGER,       -- ä¸€è‡´æ€§è¯„åˆ†
    accuracy_score INTEGER,          -- å‡†ç¡®æ€§è¯„åˆ†
    
    -- ç»Ÿè®¡
    total_issues INTEGER,
    critical_issues INTEGER,
    high_issues INTEGER,
    medium_issues INTEGER,
    low_issues INTEGER,
    
    -- æŠ¥å‘Šå†…å®¹
    summary TEXT,                    -- æ€»ç»“ï¼ˆæ”¯æŒ Markdownï¼‰
    recommendations TEXT,            -- æ•´ä½“å»ºè®®ï¼ˆJSON æ•°ç»„ï¼‰
    
    -- å…ƒæ•°æ®
    evaluated_at TIMESTAMP,
    evaluator_version VARCHAR(20),   -- Agent ç‰ˆæœ¬
    
    FOREIGN KEY (course_id) REFERENCES courses(id)
);
```

#### API æ¥å£è®¾è®¡

```yaml
# POST /api/admin/rag/quality-check
# è§¦å‘æ•™ç¨‹è´¨é‡è¯„ä¼°
Request:
  course_id: string
  document_paths?: string[]    # å¯é€‰ï¼Œé»˜è®¤è¯„ä¼°å…¨éƒ¨
  check_types?: string[]       # å¯é€‰ï¼ŒæŒ‡å®šæ£€æŸ¥ç±»å‹

Response:
  task_id: string
  status: "pending"
  estimated_time: number       # é¢„ä¼°æ—¶é—´ï¼ˆç§’ï¼‰

# GET /api/admin/rag/quality-check/{task_id}
# è·å–è¯„ä¼°è¿›åº¦
Response:
  status: "pending" | "in_progress" | "completed" | "failed"
  progress: number             # 0-100
  report_id?: string           # å®Œæˆåè¿”å›

# GET /api/admin/rag/quality-reports/{report_id}
# è·å–è´¨é‡æŠ¥å‘Š
Response:
  report:
    overall_score: number
    scores:
      completeness: number
      consistency: number
      accuracy: number
    issues:
      - id: string
        document: string
        line: number
        type: string
        severity: string
        title: string
        description: string
        suggestion: string
        status: string
    summary: string

# PATCH /api/admin/rag/annotations/{annotation_id}
# æ›´æ–°æ³¨é‡ŠçŠ¶æ€ï¼ˆå®¡æ ¸ï¼‰
Request:
  status: "confirmed" | "fixed" | "ignored" | "false_positive"
  visibility?: "admin_only" | "reviewer" | "public"
  notes?: string               # å®¡æ ¸å¤‡æ³¨

Response:
  updated: boolean

# GET /api/rag/documents/{document_id}/annotations
# è·å–æ–‡æ¡£æ³¨é‡Šï¼ˆCç«¯å¯è§ï¼‰
Request:
  include_admin_only?: boolean  # ç®¡ç†ç«¯å¯è¯·æ±‚å…¨éƒ¨

Response:
  annotations:
    - line_start: number
      line_end: number
      type: string
      severity: string
      title: string
      description: string
      suggestion: string
```

#### å‰ç«¯å±•ç¤ºæ–¹æ¡ˆ

**åŸåˆ™ï¼šä¸ä¿®æ”¹åŸæ–‡ï¼Œæ¸²æŸ“æ—¶å åŠ å±•ç¤º**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ•™ç¨‹å†…å®¹å±•ç¤º                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  44: Seq2Seq æ¨¡å‹çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†ä¸€ä¸ªåºåˆ—è½¬æ¢ä¸ºå¦ä¸€ä¸ªåºåˆ—...    â”‚
â”‚  45: âš ï¸ [äº‰è®®] è¯¥æè¿°ä¸ Transformer è®ºæ–‡ä¸­çš„å®šä¹‰å­˜åœ¨å·®å¼‚     â”‚
â”‚  46:    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  47:    â”‚ ğŸ“Œ æ³¨é‡Š (ä¸­ç­‰ä¸¥é‡åº¦)                          â”‚   â”‚
â”‚  48:    â”‚                                                â”‚   â”‚
â”‚  49:    â”‚ é—®é¢˜ï¼šæ­¤å¤„æè¿°çš„ Seq2Seq ä¸ç°ä»£å®šä¹‰æœ‰å‡ºå…¥     â”‚   â”‚
â”‚  50:    â”‚                                                â”‚   â”‚
â”‚  51:    â”‚ å»ºè®®ï¼šå»ºè®®è¡¥å……è¯´æ˜ Seq2Seq æ˜¯ä¸€ç§æ¶æ„èŒƒå¼ï¼Œ   â”‚   â”‚
â”‚  52:    â”‚      è€Œ Transformer æ˜¯å…¶ä¸­ä¸€ç§å®ç°æ–¹å¼       â”‚   â”‚
â”‚  53:    â”‚                                                â”‚   â”‚
â”‚  54:    â”‚ [æŸ¥çœ‹è¯¦æƒ…] [æ ‡è®°å·²çŸ¥] [å¿½ç•¥]                  â”‚   â”‚
â”‚  55:    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  56: Encoder è´Ÿè´£å°†è¾“å…¥åºåˆ—ç¼–ç ä¸ºå›ºå®šé•¿åº¦çš„å‘é‡è¡¨ç¤º...       â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å±•ç¤ºç­–ç•¥ï¼š**

| ç”¨æˆ·ç±»å‹ | å¯è§å†…å®¹ | äº¤äº’èƒ½åŠ› |
|----------|----------|----------|
| C ç«¯æ™®é€šç”¨æˆ· | ä»… `visibility='public'` çš„æ³¨é‡Š | æŸ¥çœ‹ã€æŠ˜å  |
| å®¡æ ¸è€… | `visibility != 'admin_only'` | å®¡æ ¸ç¡®è®¤ |
| ç®¡ç†å‘˜ | å…¨éƒ¨æ³¨é‡Š | å®Œå…¨ç®¡ç† |

**å‰ç«¯ç»„ä»¶è®¾è®¡ï¼š**

```tsx
// components/DocumentViewer.tsx

interface Annotation {
  lineStart: number;
  lineEnd: number;
  type: 'controversial' | 'error' | 'outdated' | 'suggestion';
  severity: 'low' | 'medium' | 'high' | 'critical';
  title: string;
  description: string;
  suggestion?: string;
}

interface DocumentViewerProps {
  content: string;              // åŸå§‹ markdown å†…å®¹
  annotations: Annotation[];    // æ³¨é‡Šæ•°æ®ï¼ˆä» API è·å–ï¼‰
  userRole: 'user' | 'reviewer' | 'admin';
}

// æ¸²æŸ“é€»è¾‘ï¼š
// 1. å°† content æŒ‰è¡Œåˆ†å‰²
// 2. éå†æ¯ä¸€è¡Œï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å¯¹åº”çš„ annotation
// 3. åœ¨å¯¹åº”è¡Œä¸‹æ–¹æ’å…¥ AnnotationCard ç»„ä»¶
// 4. æ”¯æŒ AnnotationCard æŠ˜å /å±•å¼€
```

#### Agent è¯„ä¼°æç¤ºè¯æ¨¡æ¿

```markdown
# æ•™ç¨‹è´¨é‡è¯„ä¼°ä»»åŠ¡

ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„æŠ€æœ¯æ–‡æ¡£å®¡æ ¸ä¸“å®¶ã€‚è¯·å¯¹ä»¥ä¸‹æ•™ç¨‹æ–‡æ¡£è¿›è¡Œå…¨é¢è¯„ä¼°ã€‚

## è¯„ä¼°ç»´åº¦

1. **å†…å®¹å®Œæ•´æ€§**
   - æ˜¯å¦æœ‰æœªå®Œæˆæˆ–ç¼ºå¤±çš„ç« èŠ‚
   - ç¤ºä¾‹ä»£ç æ˜¯å¦å®Œæ•´å¯è¿è¡Œ
   - æ˜¯å¦æœ‰å¼•ç”¨ä½†æœªè§£é‡Šçš„æ¦‚å¿µ

2. **é€»è¾‘ä¸€è‡´æ€§**
   - å‰åæè¿°æ˜¯å¦çŸ›ç›¾
   - æœ¯è¯­ä½¿ç”¨æ˜¯å¦ä¸€è‡´
   - éš¾åº¦é€’è¿›æ˜¯å¦åˆç†

3. **å‡†ç¡®æ€§æ£€æŸ¥**
   - æŠ€æœ¯æè¿°æ˜¯å¦æ­£ç¡®
   - ä»£ç ç¤ºä¾‹æ˜¯å¦æœ‰é”™è¯¯
   - ç‰ˆæœ¬ä¿¡æ¯æ˜¯å¦è¿‡æ—¶

4. **äº‰è®®è¯†åˆ«**
   - æ˜¯å¦åŒ…å«æœ‰äº‰è®®çš„è§‚ç‚¹
   - æ˜¯å¦ä¸æƒå¨èµ„æ–™å­˜åœ¨å·®å¼‚
   - æ˜¯å¦éœ€è¦é¢å¤–è¯´æ˜æˆ–å…è´£å£°æ˜

## è¾“å‡ºæ ¼å¼

å¯¹äºå‘ç°çš„æ¯ä¸ªé—®é¢˜ï¼Œè¯·æŒ‰ä»¥ä¸‹æ ¼å¼è¾“å‡ºï¼š

```json
{
  "line_range": [start, end],
  "text_snippet": "ç›¸å…³æ–‡æœ¬...",
  "type": "controversial|error|outdated|incomplete|suggestion",
  "severity": "low|medium|high|critical",
  "title": "ç®€çŸ­æ ‡é¢˜",
  "description": "è¯¦ç»†é—®é¢˜æè¿°",
  "suggestion": "ä¿®æ”¹å»ºè®®ï¼ˆå¦‚æœ‰ï¼‰",
  "references": ["å‚è€ƒèµ„æ–™é“¾æ¥"]
}
```

## å¾…è¯„ä¼°æ–‡æ¡£

[æ–‡æ¡£å†…å®¹]
```

### 3.4 ChromaDB å­˜å‚¨æ–¹æ¡ˆ

#### ç›®å½•ç»“æ„

```
src/backend/
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ app.db                 # SQLite ä¸šåŠ¡æ•°æ®
â”‚   â””â”€â”€ chroma/                # ChromaDB å‘é‡æ•°æ® (gitignore)
â”‚       â”œâ”€â”€ chroma.sqlite3     # å…ƒæ•°æ®
â”‚       â””â”€â”€ {collection_id}/   # å‘é‡æ–‡ä»¶
â”‚
â””â”€â”€ config/
    â””â”€â”€ rag_config.yaml        # RAG é…ç½®
```

#### .gitignore æ›´æ–°

```gitignore
# ChromaDB å‘é‡æ•°æ®
src/backend/data/chroma/

# æˆ–è€…æ›´ç²¾ç¡®çš„è§„åˆ™
**/chroma/
*.chroma
```

#### å®¹å™¨åŒ–åœºæ™¯

```yaml
# docker-compose.yml æ›´æ–°
services:
  backend:
    volumes:
      - ./src/backend/data:/app/data      # åŒ…å« chroma å­ç›®å½•
      - ./config:/app/config:ro           # é…ç½®æ–‡ä»¶åªè¯»
```

### 3.5 æ²™ç®±éš”ç¦»æ–¹æ¡ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Sandbox Architecture                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Admin Request  â”‚       â”‚  Sandbox Executor       â”‚ â”‚
â”‚  â”‚  (è¯„ä¼°ä»»åŠ¡)     â”‚â”€â”€â”€â”€â”€â”€â–¶â”‚  (ç‹¬ç«‹è¿›ç¨‹/å®¹å™¨)        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                        â”‚               â”‚
â”‚                                        â–¼               â”‚
â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚                            â”‚  Temporary ChromaDB  â”‚   â”‚
â”‚                            â”‚  (/tmp/rag_eval_xxx) â”‚   â”‚
â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                        â”‚               â”‚
â”‚                                        â–¼               â”‚
â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚                            â”‚  Evaluation Result   â”‚   â”‚
â”‚                            â”‚  (JSON Report)       â”‚   â”‚
â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Production     â”‚       â”‚  Production ChromaDB    â”‚ â”‚
â”‚  â”‚  (ä¸å—å½±å“)     â”‚       â”‚  (åªè¯»å¿«ç…§/å®Œå…¨éš”ç¦»)    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®ç°è¦ç‚¹ï¼š**
1. è¯„ä¼°ä»»åŠ¡ä½¿ç”¨ç‹¬ç«‹çš„ä¸´æ—¶ç›®å½•
2. è¯„ä¼°å®Œæˆåè‡ªåŠ¨æ¸…ç†ä¸´æ—¶æ•°æ®
3. æ”¯æŒèµ„æºé™åˆ¶ï¼ˆCPU/å†…å­˜/æ—¶é—´ï¼‰
4. é”™è¯¯éš”ç¦»ï¼Œä¸å½±å“ä¸»æœåŠ¡

---

## å››ã€å®æ–½è®¡åˆ’

### 4.1 é‡Œç¨‹ç¢‘è§„åˆ’

```
Phase 1: åŸºç¡€ RAG (MVP)
â”œâ”€â”€ æ ¸å¿ƒç»„ä»¶
â”‚   â”œâ”€â”€ Embedding æŠ½è±¡å±‚
â”‚   â”œâ”€â”€ ChromaDB å­˜å‚¨
â”‚   â””â”€â”€ åŸºç¡€æ£€ç´¢ API
â”œâ”€â”€ æ–‡æ¡£ç®¡ç†
â”‚   â”œâ”€â”€ Markdown è§£æ
â”‚   â”œâ”€â”€ åŸºç¡€åˆ‡åˆ†ç­–ç•¥
â”‚   â””â”€â”€ å‘é‡åŒ–å…¥åº“
â””â”€â”€ é¢„è®¡å·¥æœŸ: 1-2 å‘¨

Phase 2: ç®¡ç†ç«¯ + Sandbox + è´¨é‡è¯„ä¼°
â”œâ”€â”€ ç®¡ç†ç«¯ API
â”‚   â”œâ”€â”€ æ–‡æ¡£ä¸Šä¼ /åˆ é™¤
â”‚   â””â”€â”€ é…ç½®ç®¡ç†
â”œâ”€â”€ Sandbox Agent
â”‚   â”œâ”€â”€ åˆ‡åˆ†è¯„ä¼°å·¥å…·
â”‚   â”œâ”€â”€ å¬å›æµ‹è¯•å·¥å…·
â”‚   â””â”€â”€ é…ç½®ç”Ÿæˆå™¨
â”œâ”€â”€ æ•™ç¨‹è´¨é‡è¯„ä¼°
â”‚   â”œâ”€â”€ è´¨é‡æ£€æŸ¥ Agent
â”‚   â”œâ”€â”€ æ³¨é‡Šæ•°æ®æ¨¡å‹
â”‚   â””â”€â”€ æ³¨é‡Š API æ¥å£
â””â”€â”€ é¢„è®¡å·¥æœŸ: 2-3 å‘¨

Phase 3: æµ‹è¯• UI + Rerank + æ³¨é‡Šå±•ç¤º
â”œâ”€â”€ RAG æµ‹è¯•é¡µé¢
â”‚   â”œâ”€â”€ å¬å›æ•ˆæœå¯è§†åŒ–
â”‚   â””â”€â”€ å‚æ•°è°ƒä¼˜ç•Œé¢
â”œâ”€â”€ æ³¨é‡Šå±•ç¤ºç»„ä»¶
â”‚   â”œâ”€â”€ DocumentViewer ç»„ä»¶
â”‚   â”œâ”€â”€ AnnotationCard ç»„ä»¶
â”‚   â””â”€â”€ å®¡æ ¸ç•Œé¢
â”œâ”€â”€ Rerank æ”¯æŒ
â”‚   â””â”€â”€ Cross-Encoder é›†æˆ
â””â”€â”€ é¢„è®¡å·¥æœŸ: 1-2 å‘¨

Phase 4: GraphRAG (v2)
â”œâ”€â”€ çŸ¥è¯†å›¾è°±æå–
â”œâ”€â”€ å›¾è°±å‘é‡è”åˆæ£€ç´¢
â””â”€â”€ é¢„è®¡å·¥æœŸ: 2-3 å‘¨
```

### 4.2 ä¾èµ–æ¸…å•

```toml
# pyproject.toml æ–°å¢ä¾èµ–

[project.dependencies]
# RAG æ ¸å¿ƒ
chromadb = ">=0.4.0"
sentence-transformers = ">=2.2.0"
langchain-text-splitters = ">=0.0.1"

# å¯é€‰ï¼šè¿œç¨‹ embedding
# openai = ">=1.0.0"

# å¯é€‰ï¼šæ²™ç®±éš”ç¦»
# docker = ">=6.0.0"  # å¦‚æœä½¿ç”¨å®¹å™¨çº§éš”ç¦»
```

---

## äº”ã€å¾…ç¡®è®¤äº‹é¡¹

### 5.1 å·²ç¡®è®¤çš„è®¾è®¡å†³ç­–

| å†³ç­–ç‚¹ | ç»“è®º | è¯´æ˜ |
|--------|------|------|
| **Embedding éƒ¨ç½²** | æ··åˆæ¨¡å¼ | ç”Ÿäº§ç¯å¢ƒæ”¯æŒæœ¬åœ°/API åŒæ¨¡å¼ï¼›Agent è¯„ä¼°ä¼˜å…ˆæœ¬åœ° |
| **ç®¡ç†ç«¯ UI éƒ¨ç½²** | ç‹¬ç«‹å‰ç«¯é¡¹ç›® | æŒ‰éœ€éƒ¨ç½²ï¼ŒIP ç™½åå•æ§åˆ¶ |
| **GraphRAG ä¼˜å…ˆçº§** | Phase 4 å®ç° | å…ˆå®ŒæˆåŸºç¡€ RAG |
| **Sandbox éš”ç¦»çº§åˆ«** | è¿›ç¨‹çº§ (Phase 1) | å¯é€‰å®¹å™¨çº§ (Phase 2+) |
| **æ³¨é‡Šå­˜å‚¨æ–¹æ¡ˆ** | æ•°æ®åº“å­˜å‚¨ | ç‹¬ç«‹ metadata è¡¨ï¼Œä¸ä¿®æ”¹åŸæ–‡ |
| **æ³¨é‡Šå±•ç¤ºåŸåˆ™** | å‰ç«¯å åŠ  | æ¸²æŸ“æ—¶æŒ‰è¡Œå·æ’å…¥æ³¨é‡Šå¡ç‰‡ï¼ŒåŸæ–‡ä¸å˜ |

### 5.2 æŠ€æœ¯ç»†èŠ‚å¾…å®š

| é—®é¢˜ | é€‰é¡¹ | å»ºè®® |
|------|------|------|
| **æ–‡æ¡£ç‰ˆæœ¬ç®¡ç†** | A. å•ç‰ˆæœ¬è¦†ç›–<br>B. å¤šç‰ˆæœ¬å…±å­˜ | A (MVP) |
| **å¢é‡æ›´æ–°ç­–ç•¥** | A. å…¨é‡é‡å»º<br>B. å¢é‡æ›´æ–° | B (åç»­) |
| **å¤šè¯­è¨€ Embedding** | A. å•ä¸€æ¨¡å‹<br>B. ä¸­è‹±æ–‡åˆ†ç¦» | A (text2vec-base-chinese) |
| **æœ¬åœ°æ¨¡å‹è®¾å¤‡** | A. CPU<br>B. GPU<br>C. è‡ªåŠ¨æ£€æµ‹ | C |
| **è´¨é‡è¯„ä¼°è§¦å‘** | A. æ–‡æ¡£å…¥åº“æ—¶è‡ªåŠ¨<br>B. æ‰‹åŠ¨è§¦å‘ | B (MVP)ï¼ŒA (åç»­) |
| **æ³¨é‡Šé»˜è®¤å¯è§æ€§** | A. ä»…ç®¡ç†å‘˜<br>B. å®¡æ ¸åå…¬å¼€ | A (å®‰å…¨ä¼˜å…ˆ) |
| **è´¨é‡è¯„ä¼° LLM** | A. å¤ç”¨ embedding æœåŠ¡<br>B. ç‹¬ç«‹ LLM API | B (éœ€è¦æ¨ç†èƒ½åŠ›) |

### 5.3 ç®¡ç†ç«¯åŠŸèƒ½æ¼”è¿›è·¯çº¿

```
Phase 1 (å½“å‰)
â”œâ”€â”€ RAG å¬å›æµ‹è¯•
â”œâ”€â”€ åˆ‡åˆ†ç­–ç•¥è¯„ä¼°
â”œâ”€â”€ é…ç½®å‚æ•°è°ƒä¼˜
â””â”€â”€ æ•™ç¨‹è´¨é‡è¯„ä¼°æŠ¥å‘Š

Phase 2 (è¿‘æœŸ)
â”œâ”€â”€ æ–‡æ¡£ä¸Šä¼ ç®¡ç†
â”œâ”€â”€ å‘é‡åº“å¯è§†åŒ–
â”œâ”€â”€ è¯„ä¼°æŠ¥å‘Šå¯¼å‡º
â””â”€â”€ æ³¨é‡Šå®¡æ ¸ç•Œé¢

Phase 3 (ä¸­æœŸ) - è„šæœ¬åŠŸèƒ½ UI åŒ–
â”œâ”€â”€ æ•°æ®å¯¼å…¥ (æ›¿ä»£ import_questions.py)
â”œâ”€â”€ è¯¾ç¨‹ç®¡ç† (æ›¿ä»£ init_course_data.py)
â”œâ”€â”€ é¢˜é›†ç®¡ç†
â”œâ”€â”€ æ ¼å¼è½¬æ¢ (md/docx â†’ json)
â””â”€â”€ æ³¨é‡Šå…¬å¼€å¯è§æ€§ç®¡ç†

Phase 4 (è¿œæœŸ)
â”œâ”€â”€ ç”¨æˆ·ç®¡ç†
â”œâ”€â”€ æƒé™æ§åˆ¶
â”œâ”€â”€ ç³»ç»Ÿç›‘æ§
â””â”€â”€ æ—¥å¿—å®¡è®¡
```

---

## å…­ã€é™„å½•

### A. å‚è€ƒèµ„æ–™

- [ChromaDB Documentation](https://docs.trychroma.com/)
- [Sentence Transformers](https://www.sbert.net/)
- [LlamaIndex RAG Patterns](https://docs.llamaindex.ai/)

### B. ç›¸å…³ Issue/PR

- å¾…åˆ›å»º

---

*æ–‡æ¡£ç‰ˆæœ¬: v1.2*
*åˆ›å»ºæ—¥æœŸ: 2026-02-15*
*æœ€åæ›´æ–°: 2026-02-15*

## å˜æ›´è®°å½•

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´å†…å®¹ |
|------|------|----------|
| v1.0 | 2026-02-15 | åˆå§‹ç‰ˆæœ¬ |
| v1.1 | 2026-02-15 | ç¡®è®¤ç®¡ç†ç«¯ç‹¬ç«‹éƒ¨ç½²ï¼›ç»†åŒ– Embedding éƒ¨ç½²ç­–ç•¥ï¼›æ·»åŠ ç®¡ç†ç«¯æ¼”è¿›è·¯çº¿ |
| v1.2 | 2026-02-15 | æ–°å¢æ•™ç¨‹è´¨é‡è¯„ä¼°åŠŸèƒ½ï¼›æ·»åŠ æ³¨é‡Šå®ç°æ–¹æ¡ˆï¼ˆæ•°æ®åº“å­˜å‚¨+å‰ç«¯å åŠ ï¼‰ï¼›æ›´æ–°é‡Œç¨‹ç¢‘è§„åˆ’ |
