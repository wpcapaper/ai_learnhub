# 章节详情页增强功能规划

## 需求背景

对于课程详情页（学习页面），较长的章节内容需要：
1. 让学习者了解内容规模（字数统计、预计用时）
2. 提供快速导航能力（左侧大纲导航）
3. 支持章节间快速切换（上一章/下一章）

## 功能设计

### 1. 字数统计和预计用时展示

**位置**: 章节内容区域顶部，标题下方

**展示内容**:
- 字数统计（中文字符数）
- 预计阅读时间（按 300字/分钟 计算）

**实现方式**:
- 创建 `ContentStats` 组件
- 在 Markdown 渲染前统计纯文本字数
- 根据字数计算预计用时

### 2. 左侧大纲导航栏

**位置**: Markdown 内容区域左侧（独立面板）

**功能**:
- 自动提取 Markdown 的 h1/h2/h3 标题作为大纲
- 点击标题可滚动到对应位置
- 高亮当前滚动位置的标题

**实现方式**:
- 创建 `OutlineNav` 组件
- 解析 Markdown 内容提取标题结构
- 使用 ref 实现滚动到指定位置
- 监听滚动事件更新当前激活标题

### 3. 上一章节/下一章节导航

**位置**: 章节内容区域底部（或两侧悬浮按钮）

**功能**:
- 显示上一章/下一章按钮
- 点击可跳转到对应章节
- 没有上/下一章时按钮禁用

**实现方式**:
- 在 learning/page.tsx 中获取所有章节列表
- 根据当前章节ID确定上一章和下一章
- 点击时更新 URL 参数跳转

## 技术方案

### 组件结构

```
src/frontend/components/
├── ContentStats.tsx      # 字数统计和预计用时组件
├── OutlineNav.tsx        # 大纲导航组件
└── ChapterNavigation.tsx # 章节导航组件（已存在，需增强）
```

### 页面布局调整

```
┌─────────────────────────────────────────────────────────────┐
│ 顶部导航栏                                                   │
├──────┬──────────────────────────────────┬──────────────────┤
│      │ 章节标题 | 字数: 1,234 | 约 4 分钟  │                  │
│ 大纲 │──────────────────────────────────│                  │
│ 导航 │                                  │   AI Assistant   │
│      │     Markdown 内容               │                  │
│      │                                  │                  │
│      │──────────────────────────────────│                  │
│      │  ← 上一章           下一章 →     │                  │
├──────┴──────────────────────────────────┴──────────────────┤
```

### API 依赖

需要获取章节列表信息：
- `apiClient.getLearningChapters(courseId)` - 已有
- 需确保返回章节的排序信息（sort_order）

## 实现步骤

1. **创建 ContentStats 组件**
   - 统计字数
   - 计算预计用时
   - 样式设计

2. **创建 OutlineNav 组件**
   - 解析 Markdown 提取标题
   - 实现点击跳转
   - 滚动同步高亮

3. **增强 ChapterNavigation 功能**
   - 获取章节列表
   - 计算上一章/下一章
   - 添加导航按钮

4. **修改 learning/page.tsx**
   - 调整布局结构
   - 集成新组件
   - 传递必要 props

5. **测试验证**
   - 功能测试
   - 样式适配
   - 响应式设计

## 文件变更清单

| 文件 | 操作 | 说明 |
|------|------|------|
| `src/frontend/components/ContentStats.tsx` | 新增 | 字数统计组件 |
| `src/frontend/components/OutlineNav.tsx` | 新增 | 大纲导航组件 |
| `src/frontend/app/learning/page.tsx` | 修改 | 集成新功能，调整布局 |
| `src/frontend/components/MarkdownReader.tsx` | 修改 | 添加标题 ID 支持，暴露滚动方法 |

## 风险与注意事项

1. **性能考虑**: 大纲提取不应阻塞渲染
2. **响应式设计**: 小屏幕下大纲可折叠或隐藏
3. **无障碍访问**: 导航按钮需支持键盘操作
4. **主题适配**: 新组件需支持深色/浅色主题
