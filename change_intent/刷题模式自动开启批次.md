# 刷题模式自动开启批次 - 改动方案

## 需求背景

### 问题描述
当前刷题模式进入流程为：
1. 课程页面点击"刷题模式"按钮
2. 进入次级页面（`/quiz`）
3. 显示"开始新批次"按钮（页面只有这个按钮）
4. 用户点击按钮开始刷题

**问题**：次级页面只有一个"开始新批次"按钮，显得臃肿且无意义。

### 用户需求
点击"刷题模式"后直接开始批次，跳过次级页面。

## 改动方案

### 改动思路
将"开始新批次"的逻辑从用户点击触发改为页面加载时自动触发。

### 当前流程
```
课程页 → /quiz → 显示"开始新批次"按钮 → 用户点击 → 开始批次 → 答题界面
```

### 改动后流程
```
课程页 → /quiz → 自动开始批次 → 答题界面
```

## 技术实现

### 涉及文件
- **修改文件**：`src/frontend/app/quiz/page.tsx`

### 具体改动

#### 1. 添加自动开始批次逻辑
在 `useEffect` 中添加自动调用 `startBatch()` 的逻辑：

```typescript
useEffect(() => {
  const savedUserId = localStorage.getItem('userId');
  if (savedUserId) {
    setUserId(savedUserId);
  }

  if (courseId) {
    apiClient.getCourse(courseId).then(setCourse).catch(console.error);
  }

  // 新增：自动开始批次
  if (savedUserId && courseId && !batch) {
    startBatch();
  }
}, [courseId]);
```

#### 2. 移除"开始新批次"按钮UI
删除第309-319行的按钮UI代码：

```typescript
// 删除这段代码
{!batch && (
  <div className="text-center">
    <button
      onClick={startBatch}
      disabled={loading}
      className="bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-lg"
    >
      {loading ? '加载中...' : '开始新批次'}
    </button>
  </div>
)}
```

### 改动详情

#### 修改点1：添加自动开始批次的useEffect
- **位置**：`QuizContent` 组件的 `useEffect` 钩子
- **逻辑**：当 `userId` 和 `courseId` 都存在且没有当前批次时，自动调用 `startBatch()`
- **依赖**：需要确保 `startBatch` 函数已定义

#### 修改点2：删除"开始新批次"按钮
- **位置**：第309-319行
- **原因**：不再需要手动点击开始批次

## 影响范围分析

### 影响的模块
- **前端**：
  - ✅ `src/frontend/app/quiz/page.tsx`（仅此文件）

### 不受影响的模块
- ❌ 后端API（无需任何改动）
- ❌ 考试模式（`/exam` 页面）
- ❌ 错题本（`/mistakes` 页面）
- ❌ 课程页面（`/courses` 页面）
- ❌ 其他功能模块

## 风险评估

### 技术风险
| 风险项 | 等级 | 说明 | 应对措施 |
|--------|------|------|----------|
| 自动批次创建失败 | 低 | `startBatch()` 已有完善的错误处理 | 复用现有错误处理逻辑 |
| 用户体验下降 | 极低 | 减少了一次点击，体验更好 | - |
| 状态管理混乱 | 低 | 复用现有 `startBatch()` 逻辑 | - |

### 业务风险
| 风险项 | 等级 | 说明 | 应对措施 |
|--------|------|------|----------|
| 用户无法手动控制批次开始 | 极低 | 用户需求就是自动开始 | - |
| 批次创建重复调用 | 低 | 通过 `!batch` 条件控制 | 添加条件判断 |

## 预期效果

### 用户体验提升
- ✅ 减少1次点击操作
- ✅ 减少页面跳转感知
- ✅ 更流畅的刷题体验

### 代码优化
- ✅ 移除无意义的中间页面
- ✅ 代码更简洁
- ✅ 降低维护成本

## 实施步骤

1. ✅ 在 `change_intent/` 目录创建本文档
2. ⏳ 修改 `src/frontend/app/quiz/page.tsx`：
   - 添加自动开始批次的 `useEffect`
   - 删除"开始新批次"按钮UI
3. ⏳ 使用 `lsp_diagnostics` 验证代码
4. ⏳ 在 `change_log/` 目录编写改动日志
5. ⏳ 本地测试验证功能正常

## 验证标准

修改完成后，需要验证：
- [ ] 点击课程页面的"刷题模式"按钮，直接进入答题界面（不再显示"开始新批次"按钮）
- [ ] 批次创建成功，题目正常显示
- [ ] 答题、提交答案、完成批次等功能正常
- [ ] `lsp_diagnostics` 检查无错误
- [ ] 考试模式、错题本等其他功能不受影响

## 回滚方案

如果发现问题，可以快速回滚：
1. 恢复 `src/frontend/app/quiz/page.tsx` 文件
2. 重新启动前端服务

## 关联文档

- 原始需求：用户口头描述
- 改动日志：`change_log/刷题模式自动开启批次.md`（待编写）
