# å›ºå®šé¢˜é›†ä¿®å¤ - éªŒè¯æŠ¥å‘Š

## é—®é¢˜æè¿°

**åŸå§‹é—®é¢˜**ï¼š
å›ºå®šé¢˜é›†æ¨¡å¼æŠ¥é”™ï¼š`single_choice: è¯·æ±‚30é¢˜ï¼Œä½†é¢˜åº“åªæœ‰20é¢˜å¯ç”¨`

**æ ¹æœ¬åŸå› **ï¼š
åœ¨ `src/backend/app/api/exam.py` çš„ç¬¬ 61 è¡Œï¼Œ`exam_mode` è¢«ç¡¬ç¼–ç ä¸º `"extraction"`ï¼š
```python
batch = ExamService.start_exam(
    db,
    user_id=user_id,
    course_id=request.course_id,
    exam_mode="extraction",  # â† ç¡¬ç¼–ç ï¼
    question_type_config=None,
    difficulty_range=request.difficulty_range,
    question_set_code=request.question_set_id
)
```

**å½±å“**ï¼š
å³ä½¿å‰ç«¯ä¼ é€’äº† `question_set_id` é€‰æ‹©å›ºå®šé¢˜é›†ï¼Œåç«¯ä»ç„¶ä½¿ç”¨åŠ¨æ€æŠ½å–æ¨¡å¼ï¼Œå› æ­¤ä¼šè¿›è¡Œé¢˜å‹æ•°é‡éªŒè¯ï¼Œå¯¼è‡´æŠ¥é”™ã€‚

## ä¿®å¤æ–¹æ¡ˆ

### ä¿®æ”¹æ–‡ä»¶ï¼š`src/backend/app/api/exam.py`

### ä¿®æ”¹å†…å®¹
æ ¹æ®æ˜¯å¦ä¼ é€’äº† `question_set_id` æ¥è‡ªåŠ¨å†³å®šè€ƒè¯•æ¨¡å¼ï¼š
- å¦‚æœæœ‰ `question_set_id`ï¼Œåˆ™ä½¿ç”¨ `fixed_set` æ¨¡å¼
- å¦åˆ™ä½¿ç”¨ `extraction` æ¨¡å¼

```python
# æ ¹æ®æ˜¯å¦ä¼ é€’é¢˜é›†ä»£ç å†³å®šè€ƒè¯•æ¨¡å¼
# å¦‚æœæœ‰ question_set_idï¼Œåˆ™ä½¿ç”¨å›ºå®šé¢˜é›†æ¨¡å¼ï¼›å¦åˆ™ä½¿ç”¨åŠ¨æ€æŠ½å–æ¨¡å¼
exam_mode = "fixed_set" if request.question_set_id else "extraction"
batch = ExamService.start_exam(
    db,
    user_id=user_id,
    course_id=request.course_id,
    exam_mode=exam_mode,  # â† æ ¹æ®æ˜¯å¦ä¼ é¢˜é›†ä»£ç åŠ¨æ€å†³å®š
    question_type_config=None,
    difficulty_range=request.difficulty_range,
    question_set_code=request.question_set_id
)
```

### æ·»åŠ çš„æ³¨é‡Š
```python
# æ ¹æ®æ˜¯å¦ä¼ é€’é¢˜é›†ä»£ç å†³å®šè€ƒè¯•æ¨¡å¼
# å¦‚æœæœ‰ question_set_idï¼Œåˆ™ä½¿ç”¨å›ºå®šé¢˜é›†æ¨¡å¼ï¼›å¦åˆ™ä½¿ç”¨åŠ¨æ€æŠ½å–æ¨¡å¼
```
**æ³¨é‡ŠåŸå› **ï¼šè¿™æ˜¯ API å±‚çš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œéœ€è¦æ˜ç¡®è¯´æ˜åˆ¤æ–­ä¾æ®ã€‚

## éªŒè¯ç»“æœ

### 1. å›ºå®šé¢˜é›†æ¨¡å¼æµ‹è¯•

**è¯·æ±‚**ï¼š
```bash
curl -X POST "http://localhost:8000/api/exam/start?user_id=test_user_123" \
  -H "Content-Type: application/json" \
  -d '{
    "course_id": "c42a1b60a6766c252e7f93a3f90a98b6",
    "question_set_id": "ai_cert_exam_primary"
  }'
```

**å“åº”**ï¼š
```json
{
  "exam_id": "ac3acaf4-3f3b-4544-9ba2-c45a8c3ee007",
  "total_questions": 40,
  "mode": "exam",
  "started_at": "2026-01-21T10:48:55.505988",
  "status": "in_progress"
}
```

**éªŒè¯ç»“æœ**ï¼šâœ… æˆåŠŸ
- `total_questions`: 40ï¼ˆé¢˜é›†ä¸­çš„æ€»é¢˜ç›®æ•°ï¼‰
- `mode`: "exam"
- çŠ¶æ€ï¼šæ­£å¸¸å¯åŠ¨

### 2. è·å–è€ƒè¯•é¢˜ç›®éªŒè¯

**è¯·æ±‚**ï¼š
```bash
curl -s "http://localhost:8000/api/exam/ac3acaf4-3f3b-4544-9ba2-c45a8c3ee007/questions?user_id=test_user_123&show_answers=false" | jq '. | length'
```

**ç»“æœ**ï¼š40

**éªŒè¯ç»“æœ**ï¼šâœ… æˆåŠŸ
- é¢˜ç›®æ•°é‡æ­£ç¡®ï¼š40 é¢˜
- ä¸é¢˜é›†çš„æ€»é¢˜ç›®æ•°ä¸€è‡´

### 3. é¢˜ç›®å†…å®¹éªŒè¯

**ç¤ºä¾‹é¢˜ç›® 1ï¼ˆå•é€‰é¢˜ï¼‰**ï¼š
```json
{
  "id": "1009021dfa45e3be0637fc19fdebcb8d",
  "content": "åœ¨ä¼˜åŒ–å¤§æ¨¡å‹åº”ç”¨çš„ç”¨æˆ·ä½“éªŒæ—¶ï¼Œä»¥ä¸‹å“ªä¸ªå› ç´ æœ€ä¸é‡è¦ï¼Ÿ",
  "question_type": "single_choice",
  "options": {
    "A": "å“åº”é€Ÿåº¦",
    "B": "å›ç­”è´¨é‡",
    "C": "ä»£ç è¡Œæ•°",
    "D": "é”™è¯¯å¤„ç†"
  },
  "correct_answer": null,
  "explanation": null,
  "user_answer": null,
  "is_correct": null,
  "answered_at": "2026-01-21T10:48:55.508335"
}
```

**ç¤ºä¾‹é¢˜ç›® 2ï¼ˆåˆ¤æ–­é¢˜ï¼‰**ï¼š
```json
{
  "id": "1d76575edf64f25615b5a95a20ec3ac2",
  "content": "ä»æŠ€æœ¯å‘å±•è§’åº¦çœ‹ï¼ŒåŸºäºè§„åˆ™çš„å¯¹è¯ç³»ç»Ÿã€åŸºäºç»Ÿè®¡çš„å¯¹è¯ç³»ç»Ÿå’ŒåŸºäºç¥ç»ç½‘ç»œçš„å¯¹è¯ç³»ç»Ÿæ˜¯é€æ­¥æ¼”å˜çš„è¿‡ç¨‹ã€‚",
  "question_type": "true_false",
  "options": {
    "A": "å¯¹",
    "B": "é”™"
  },
  "correct_answer": null,
  "explanation": null,
  "user_answer": null,
  "is_correct": null,
  "answered_at": "2026-01-21T10:48:55.508337"
}
```

**éªŒè¯ç»“æœ**ï¼šâœ… æˆåŠŸ
- é¢˜ç›®å†…å®¹æ­£ç¡®
- é¢˜å‹è¯†åˆ«æ­£ç¡®
- é€‰é¡¹æ­£ç¡®
- è€ƒè¯•è¿›è¡Œä¸­ï¼Œä¸æ˜¾ç¤ºæ­£ç¡®ç­”æ¡ˆå’Œè§£æï¼ˆcorrect_answerã€explanation ä¸º nullï¼‰

### 4. é¢˜é›†é¢˜å‹åˆ†å¸ƒéªŒè¯

**SQL æŸ¥è¯¢**ï¼š
```python
from app.models import Question, QuestionSet
qs = db.query(QuestionSet).filter(QuestionSet.code == 'ai_cert_exam_primary').first()
ids = qs.fixed_question_ids
questions = db.query(Question).filter(Question.id.in_(ids)).all()

# æŒ‰é¢˜å‹ç»Ÿè®¡
type_counts = {}
for q in questions:
    qt = q.question_type
    type_counts[qt] = type_counts.get(qt, 0) + 1
```

**ç»“æœ**ï¼š
```
é¢˜é›†: ai_cert_exam_primary
é¢˜å‹åˆ†å¸ƒ:
  single_choice: 20é¢˜
  true_false: 10é¢˜
  multiple_choice: 10é¢˜
```

**éªŒè¯ç»“æœ**ï¼šâœ… æˆåŠŸ
- å•é€‰é¢˜ï¼š20 é¢˜
- å¤šé€‰é¢˜ï¼š10 é¢˜
- åˆ¤æ–­é¢˜ï¼š10 é¢˜
- æ€»è®¡ï¼š40 é¢˜

## å·²ä¿®å¤é—®é¢˜

### âœ… æ ¸å¿ƒé—®é¢˜
- [x] å›ºå®šé¢˜é›†æ¨¡å¼ä¸å†è¿›è¡Œé¢˜å‹æ•°é‡éªŒè¯
- [x] æ ¹æ®æ˜¯å¦ä¼ é€’ `question_set_id` è‡ªåŠ¨å†³å®šè€ƒè¯•æ¨¡å¼
- [x] å›ºå®šé¢˜é›†æ¨¡å¼ç›´æ¥ä½¿ç”¨é¢˜é›†ä¸­çš„å…¨éƒ¨é¢˜ç›®
- [x] å›ºå®šé¢˜é›†æ¨¡å¼ä¸å†ä¸åŠ¨æ€æŠ½å–è€¦åˆ

### âœ… æ•°æ®éªŒè¯
- [x] é¢˜é›†æ•°æ®æ­£ç¡®ï¼ˆ40 é¢˜ï¼‰
- [x] é¢˜å‹åˆ†å¸ƒæ­£ç¡®ï¼ˆ20 å•é€‰ + 10 å¤šé€‰ + 10 åˆ¤æ–­ï¼‰
- [x] é¢˜ç›®å…³è”æ­£ç¡®ï¼ˆquestion_set_ids å­—æ®µï¼‰

### âœ… API éªŒè¯
- [x] å›ºå®šé¢˜é›†æ¨¡å¼æ­£å¸¸å¯åŠ¨
- [x] è¿”å›æ­£ç¡®çš„é¢˜ç›®æ•°é‡
- [x] é¢˜ç›®å†…å®¹æ­£ç¡®
- [x] è€ƒè¯•è¿›è¡Œä¸­ä¸æ˜¾ç¤ºç­”æ¡ˆå’Œè§£æ

## å·²çŸ¥é—®é¢˜ï¼ˆä¸æœ¬æ¬¡ä¿®å¤æ— å…³ï¼‰

### åŠ¨æ€æŠ½å–æ¨¡å¼çš„é¢˜åº“é™åˆ¶

**é—®é¢˜æè¿°**ï¼š
åŠ¨æ€æŠ½å–æ¨¡å¼ä»ç„¶ä¼šè¿›è¡Œé¢˜å‹æ•°é‡éªŒè¯ï¼Œå¦‚æœé¢˜åº“ä¸­çš„é¢˜ç›®æ•°é‡ä¸è¶³ï¼Œä¼šæŠ¥é”™ï¼š
```
single_choice: è¯·æ±‚30é¢˜ï¼Œä½†é¢˜åº“åªæœ‰20é¢˜å¯ç”¨
```

**åŸå› **ï¼š
- è¯¾ç¨‹çš„é»˜è®¤é…ç½®ï¼šå•é€‰é¢˜ 30 é¢˜ã€å¤šé€‰é¢˜ 10 é¢˜ã€åˆ¤æ–­é¢˜ 10 é¢˜ï¼ˆå…± 50 é¢˜ï¼‰
- å½“å‰é¢˜åº“ï¼šå•é€‰é¢˜ 20 é¢˜ã€å¤šé€‰é¢˜ 10 é¢˜ã€åˆ¤æ–­é¢˜ 10 é¢˜ï¼ˆå…± 40 é¢˜ï¼‰
- å•é€‰é¢˜æ•°é‡ä¸è¶³ï¼ˆ20 < 30ï¼‰

**è¿™ä¸æ˜¯ä»£ç é—®é¢˜**ï¼Œè€Œæ˜¯ä¸šåŠ¡æ•°æ®é—®é¢˜ã€‚æœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š

**æ–¹æ¡ˆ 1**ï¼šä¿®æ”¹è¯¾ç¨‹é»˜è®¤é…ç½®
å°†å•é€‰é¢˜é…ç½®è°ƒæ•´ä¸º 20 é¢˜ï¼š
```sql
UPDATE courses
SET default_exam_config = json_object(
  'question_type_config', json_object(
    'single_choice', 20,
    'multiple_choice', 10,
    'true_false', 10
  ),
  'difficulty_range', json_array('[1,5]')
)
WHERE code = 'ai_cert_exam';
```

**æ–¹æ¡ˆ 2**ï¼šå¯¼å…¥æ›´å¤šå•é€‰é¢˜åˆ°é¢˜åº“
æ‰©å±•é¢˜åº“ï¼Œæ·»åŠ æ›´å¤šå•é€‰é¢˜ã€‚

## ç»“è®º

### âœ… ä¿®å¤å®Œæˆ
å›ºå®šé¢˜é›†æ¨¡å¼å·²ç»å®Œå…¨ä¿®å¤ï¼š
1. å›ºå®šé¢˜é›†æ¨¡å¼ä¸å†è¿›è¡Œé¢˜å‹æ•°é‡éªŒè¯
2. æ ¹æ®æ˜¯å¦ä¼ é€’ `question_set_id` è‡ªåŠ¨å†³å®šè€ƒè¯•æ¨¡å¼
3. å›ºå®šé¢˜é›†æ¨¡å¼ç›´æ¥ä½¿ç”¨é¢˜é›†ä¸­çš„å…¨éƒ¨é¢˜ç›®ï¼ˆ40 é¢˜ï¼‰
4. å›ºå®šé¢˜é›†æ¨¡å¼ä¸åŠ¨æ€æŠ½å–æ¨¡å¼å®Œå…¨è§£è€¦

### ğŸ“ æ³¨æ„äº‹é¡¹
- åŠ¨æ€æŠ½å–æ¨¡å¼ä»ç„¶ä¼šè¿›è¡Œé¢˜å‹æ•°é‡éªŒè¯ï¼ˆè¿™æ˜¯æ­£ç¡®çš„è¡Œä¸ºï¼‰
- å¦‚æœéœ€è¦åŠ¨æ€æŠ½å–æ¨¡å¼æ­£å¸¸å·¥ä½œï¼Œéœ€è¦è°ƒæ•´è¯¾ç¨‹é»˜è®¤é…ç½®æˆ–å¯¼å…¥æ›´å¤šé¢˜ç›®

### ğŸ§ª åç»­æµ‹è¯•
å»ºè®®è¿›è¡Œä»¥ä¸‹æ‰‹åŠ¨æµ‹è¯•ï¼š
1. å‰ç«¯æµ‹è¯•å›ºå®šé¢˜é›†æ¨¡å¼
   - é€‰æ‹©"å›ºå®šé¢˜é›†"æ¨¡å¼
   - é€‰æ‹©"å¤§æ¨¡å‹åº”ç”¨å¼€å‘åˆçº§ (40 é¢˜)"
   - å¼€å§‹è€ƒè¯•å¹¶éªŒè¯æµç¨‹
2. å‰ç«¯æµ‹è¯•åŠ¨æ€æŠ½å–æ¨¡å¼ï¼ˆå›å½’æµ‹è¯•ï¼‰
   - é€‰æ‹©"åŠ¨æ€æŠ½å–"æ¨¡å¼
   - å¼€å§‹è€ƒè¯•
   - ï¼ˆå¦‚æœæŠ¥é”™ï¼Œè°ƒæ•´é…ç½®æˆ–å¯¼å…¥æ›´å¤šé¢˜ç›®ï¼‰

---

**ä¿®å¤äºº**: Sisyphus AI Agent
**ä¿®å¤æ—¥æœŸ**: 2026-01-21
**çŠ¶æ€**: âœ… ä¿®å¤å®Œæˆå¹¶éªŒè¯
