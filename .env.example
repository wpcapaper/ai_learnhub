# ============================================================
# AILearn Hub 统一环境配置
# ============================================================
# 复制此文件为 .env 并根据需要修改
# 所有服务启动时都会读取此文件
#
# 端口规划:
# ┌─────────────────────┬────────┬─────────────────────────┐
# │ 服务                │ 端口   │ 说明                    │
# ├─────────────────────┼────────┼─────────────────────────┤
# │ Backend API         │ 8000   │ 核心业务 API            │
# │ Frontend (C端)      │ 3000   │ 用户端前端              │
# │ Admin Frontend      │ 8080   │ 管理端前端              │
# │ Langfuse            │ 9090   │ LLM 监控平台            │
# │ Redis               │ 6379   │ 缓存服务                │
# │ PostgreSQL          │ 5432   │ 数据库 (Langfuse 用)    │
# └─────────────────────┴────────┴─────────────────────────┘
# ============================================================

# ==================== 端口配置 ====================
# 核心服务
BACKEND_PORT=8000
FRONTEND_PORT=3000

# 管理端
ADMIN_FRONTEND_PORT=8080

# 监控
LANGFUSE_PORT=9090

# 基础设施 (通常不需要修改)
REDIS_PORT=6379
POSTGRES_PORT=5432

# ==================== 服务 URL ====================
# 用于服务间通信和 CORS 配置
BACKEND_URL=http://localhost:${BACKEND_PORT}
FRONTEND_URL=http://localhost:${FRONTEND_PORT}
ADMIN_FRONTEND_URL=http://localhost:${ADMIN_FRONTEND_PORT}
LANGFUSE_URL=http://localhost:${LANGFUSE_PORT}

# CORS 允许的源 (逗号分隔)
# 开发环境 (DEV_MODE=true)：自动允许所有 localhost/127.0.0.1 端口，方便本地开发
# 生产环境：必须显式配置，否则拒绝所有跨域请求
# ALLOWED_ORIGINS=https://yourdomain.com,https://admin.yourdomain.com

# ==================== 数据库配置 ====================
DATABASE_URL=sqlite:///./data/app.db
# 生产环境使用 PostgreSQL:
# DATABASE_URL=postgresql://user:password@localhost:5432/ailearn

# ==================== Redis 配置 ====================
REDIS_URL=redis://localhost:${REDIS_PORT}/0

# ==================== LLM 配置 ====================
# 用于 AI 助教、质量评估等
LLM_API_KEY=your-api-key-here
LLM_BASE_URL=https://api.openai.com/v1
LLM_MODEL=gpt-3.5-turbo

# ==================== Langfuse 监控 ====================
LANGFUSE_PUBLIC_KEY=
LANGFUSE_SECRET_KEY=
LANGFUSE_HOST=http://localhost:${LANGFUSE_PORT}

# ==================== RAG 配置 ====================
# Embedding 提供商: openai | local | custom
RAG_EMBEDDING_PROVIDER=openai
RAG_OPENAI_API_KEY=your-openai-api-key
RAG_OPENAI_BASE_URL=https://api.openai.com/v1
RAG_EMBEDDING_MODEL=text-embedding-3-small

# 本地模式 (Ollama)
# RAG_EMBEDDING_PROVIDER=local
# RAG_EMBEDDING_SERVICE_URL=http://localhost:11434/api/embeddings
# RAG_EMBEDDING_LOCAL_MODEL=nomic-embed-text

# 检索模式: vector | vector_rerank | hybrid
RAG_RETRIEVAL_MODE=vector

# Rerank (可选)
RAG_RERANK_ENABLED=false
RAG_RERANK_PROVIDER=local
# RAG_RERANK_SERVICE_URL=http://localhost:2000/rerank

# ==================== 安全配置 ====================
SECRET_KEY=your-secret-key-change-me
DEV_MODE=true

# Admin API IP 白名单 (逗号分隔)
# Docker 环境需要添加网关 IP: 192.168.65.1 (Docker Desktop)
ADMIN_ALLOWED_IPS=127.0.0.1,::1,localhost,192.168.65.1
